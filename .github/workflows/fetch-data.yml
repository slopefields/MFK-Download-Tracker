name: Fetch Thunderstore Mod Data

on:
  workflow_dispatch:
  schedule:
    # Run at 8am and 12pm UTC (12am and 12pm PST)
    - cron: "0 8,20 * * *"
    # cron formatting:
    # 0 = minute
    # 8,20 = 8am and 8pm UTC
    # * = Every day of month
    # * = Every month of year
    # * = Every week of month

jobs:
  get-data:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Fetch mod data from Thunderstore and print contents
        run: |
          curl -v -o data.json https://thunderstore.io/api/v1/package-metrics/Plotection/MoneyForKills
          echo "Contents:"
          cat data.json

      - name: Validate fetched data (Is it empty?)
        run: |
          if [ ! -s data.json ]; then
            echo "data.json is empty"
            exit 1
          fi

      - name: Commit fetched data to repo
        run: |
          git config --global user.name "GitHub Action"
          git config --global user.email "github-actions[bot]@users.noreply.github.com"
          git add data.json
          git commit -m "Update data.json with latest data"
          git push
